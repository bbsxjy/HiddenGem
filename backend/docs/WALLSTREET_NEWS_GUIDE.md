# åå°”è¡—è§é—»æ–°é—»APIä½¿ç”¨æŒ‡å—

## ğŸ“Š æ¦‚è¿°

åå°”è¡—è§é—»ï¼ˆWallStreetCNï¼‰æ˜¯å›½å†…é¢†å…ˆçš„å®æ—¶è´¢ç»èµ„è®¯å¹³å°ï¼Œæä¾›7x24å°æ—¶è´¢ç»å¿«è®¯ã€‚æœ¬é¡¹ç›®å·²å°†åå°”è¡—è§é—»APIé›†æˆåˆ°æ–°é—»èšåˆç³»ç»Ÿä¸­ã€‚

## ğŸ¯ ç‰¹ç‚¹

### ä¼˜åŠ¿
- âœ… **å®Œå…¨å…è´¹**: æ— éœ€API key
- âœ… **æ›´æ–°å¿«**: å®æ—¶è´¢ç»å¿«è®¯ï¼Œæ›´æ–°é¢‘ç‡é«˜
- âœ… **ä¸­è‹±æ–‡**: æ”¯æŒä¸­è‹±æ–‡è´¢ç»æ–°é—»
- âœ… **è´¨é‡é«˜**: ä¸“ä¸šè´¢ç»å›¢é˜Ÿç¼–è¾‘

### é™åˆ¶
- âš ï¸ **å®è§‚ä¸ºä¸»**: ä¸»è¦æ˜¯å®è§‚ç»æµã€å¸‚åœºåŠ¨æ€æ–°é—»
- âš ï¸ **ä¸ªè‚¡è¾ƒå°‘**: é’ˆå¯¹ç‰¹å®šä¸ªè‚¡çš„æ–°é—»ç›¸å¯¹è¾ƒå°‘
- â„¹ï¸ **æ— è‚¡ç¥¨ç­›é€‰**: APIä¸æ”¯æŒæŒ‰è‚¡ç¥¨ä»£ç ç­›é€‰ï¼Œéœ€è¦åæœŸè¿‡æ»¤

## ğŸ“‹ APIä¿¡æ¯

**ç«¯ç‚¹**: `https://api-prod.wallstreetcn.com/apiv1/content/lives`

**å‚æ•°**:
```python
{
    'channel': 'global-channel',  # å…¨å±€é¢‘é“
    'client': 'pc',               # å®¢æˆ·ç«¯ç±»å‹
    'cursor': '',                 # åˆ†é¡µæ¸¸æ ‡
    'limit': 50                   # æ¯é¡µæ•°é‡ï¼ˆ1-50ï¼‰
}
```

**å“åº”æ ¼å¼**:
```json
{
  "code": 20000,
  "data": {
    "items": [
      {
        "id": 3008549,
        "title": "æ ‡é¢˜",
        "content": "<p>HTMLæ ¼å¼çš„å†…å®¹</p>",
        "content_text": "çº¯æ–‡æœ¬å†…å®¹",
        "display_time": 1763713847,  // Unixæ—¶é—´æˆ³
        "author": {
          "display_name": "ä½œè€…å"
        },
        "channels": ["global-channel", "forex-channel"],
        "symbols": [],  // ç›¸å…³è‚¡ç¥¨ä»£ç ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰
        "tags": []
      }
    ],
    "next_cursor": "..."
  }
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. é€šè¿‡ç»Ÿä¸€æ–°é—»æ¥å£ï¼ˆæ¨èï¼‰

åå°”è¡—è§é—»å·²é›†æˆåˆ°æ–°é—»èšåˆç³»ç»Ÿä¸­ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ï¼š

```python
from tradingagents.dataflows.realtime_news_utils import get_realtime_stock_news

# è·å–è‚¡ç¥¨æ–°é—»ï¼ˆè‡ªåŠ¨åŒ…å«åå°”è¡—è§é—»ï¼‰
news_report = get_realtime_stock_news(
    ticker='600519.SH',      # è‚¡ç¥¨ä»£ç 
    curr_date='2025-11-21',  # å½“å‰æ—¥æœŸ
    hours_back=24            # å›æº¯24å°æ—¶
)

print(news_report)
```

**æ–°é—»æºä¼˜å…ˆçº§**ï¼ˆä¸­æ–‡è´¢ç»æ–°é—»ï¼‰:
1. **Tushareæ–°é—»** - ä½¿ç”¨ä¸“ç”¨token
2. **è´¢è”ç¤¾** - å®æ—¶å¿«è®¯
3. **åå°”è¡—è§é—»** - å®æ—¶å¿«è®¯ï¼ˆæ–°å¢ï¼‰
4. **Googleæ–°é—»** - å¤‡é€‰æ–¹æ¡ˆ

### 2. ç›´æ¥è°ƒç”¨åå°”è¡—è§é—»

å¦‚æœåªéœ€è¦åå°”è¡—è§é—»çš„æ–°é—»ï¼š

```python
from tradingagents.dataflows.realtime_news_utils import RealtimeNewsAggregator

aggregator = RealtimeNewsAggregator()

# è·å–åå°”è¡—è§é—»æ–°é—»
news_items = aggregator._fetch_wallstreet_news(
    ticker='AAPL',      # è‚¡ç¥¨ä»£ç ï¼ˆä¼šè¿›è¡Œç›¸å…³æ€§è¿‡æ»¤ï¼‰
    hours_back=24       # å›æº¯24å°æ—¶
)

# å¤„ç†æ–°é—»
for item in news_items:
    print(f"æ ‡é¢˜: {item.title}")
    print(f"æ—¶é—´: {item.publish_time}")
    print(f"æ¥æº: {item.source}")
    print(f"ç›¸å…³æ€§: {item.relevance_score}")
    print(f"å†…å®¹: {item.content}")
    print(f"é“¾æ¥: {item.url}")
    print("-" * 60)
```

### 3. ä½¿ç”¨åŸå§‹è„šæœ¬ï¼ˆç›‘æ§æ¨¡å¼ï¼‰

å¦‚æœéœ€è¦å®æ—¶ç›‘æ§æ–°å¿«è®¯ï¼Œå¯ä»¥ä½¿ç”¨åŸå§‹è„šæœ¬ï¼š

```bash
# å°†ç”¨æˆ·æä¾›çš„è„šæœ¬ä¿å­˜ä¸º wallstreet_monitor.py
python wallstreet_monitor.py
```

**åŠŸèƒ½**:
- è·å–æ‰€æœ‰å†å²å¿«è®¯å¹¶ä¿å­˜åˆ°CSV
- å®æ—¶ç›‘æ§æ–°å¿«è®¯ï¼ˆæ¯30ç§’æ£€æŸ¥ï¼‰
- è‡ªåŠ¨ä¿å­˜æ–°å¿«è®¯åˆ°CSVæ–‡ä»¶

## ğŸ“ è¿”å›æ•°æ®ç»“æ„

### NewsItem å¯¹è±¡

```python
@dataclass
class NewsItem:
    title: str              # æ–°é—»æ ‡é¢˜
    content: str            # æ–°é—»å†…å®¹ï¼ˆå·²æ¸…ç†HTMLï¼‰
    source: str             # æ¥æºï¼ˆ"åå°”è¡—è§é—» - ä½œè€…å"ï¼‰
    publish_time: datetime  # å‘å¸ƒæ—¶é—´
    url: str                # æ–°é—»é“¾æ¥
    urgency: str            # ç´§æ€¥ç¨‹åº¦ï¼ˆhigh/medium/lowï¼‰
    relevance_score: float  # ç›¸å…³æ€§è¯„åˆ†ï¼ˆ0.0-1.0ï¼‰
```

### ç›¸å…³æ€§è¯„åˆ†è§„åˆ™

| è¯„åˆ† | æ¡ä»¶ | è¯´æ˜ |
|------|------|------|
| 1.0  | è‚¡ç¥¨ä»£ç ç›´æ¥å‡ºç° | ä¾‹å¦‚: "600519"ã€"AAPL" |
| 0.9  | å…¬å¸åç§°åŒ¹é… | ä¾‹å¦‚: "èŒ…å°"ã€"Apple" |
| 0.3  | é»˜è®¤å€¼ | æœªæ£€æµ‹åˆ°æ˜ç¡®ç›¸å…³æ€§ |

**è¿‡æ»¤è§„åˆ™**: ç›¸å…³æ€§ < 0.5 çš„æ–°é—»ä¼šè¢«è‡ªåŠ¨è·³è¿‡

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯é›†æˆï¼š

```bash
cd backend
python scripts/test_wallstreet_news.py
```

**æµ‹è¯•å†…å®¹**:
1. åŸå§‹APIè°ƒç”¨æµ‹è¯•
2. åå°”è¡—è§é—»æ–°é—»è·å–æµ‹è¯•
3. å®Œæ•´æ–°é—»èšåˆæµç¨‹æµ‹è¯•

## ğŸ“Š å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1: è·å–å®è§‚è´¢ç»æ–°é—»

```python
# åå°”è¡—è§é—»æ›´é€‚åˆè·å–å®è§‚æ–°é—»
news_items = aggregator._fetch_wallstreet_news(
    ticker='',           # ä¸æŒ‡å®šè‚¡ç¥¨
    hours_back=6         # æœ€è¿‘6å°æ—¶
)

# æ‰€æœ‰æ–°é—»éƒ½ä¼šè¿”å›ï¼ˆæ— ç›¸å…³æ€§è¿‡æ»¤ï¼‰
for item in news_items:
    if item.urgency == 'high':
        print(f"ğŸ”¥ é‡è¦: {item.title}")
```

### åœºæ™¯2: ç›‘æ§ç‰¹å®šè‚¡ç¥¨

```python
# ç›‘æ§è´µå·èŒ…å°ç›¸å…³æ–°é—»
news_items = aggregator._fetch_wallstreet_news(
    ticker='600519.SH',
    hours_back=24
)

# åªè¿”å›ç›¸å…³æ€§ >= 0.5 çš„æ–°é—»
if news_items:
    print(f"å‘ç°{len(news_items)}æ¡ç›¸å…³æ–°é—»")
else:
    print("æœ€è¿‘24å°æ—¶æ— ç›¸å…³æ–°é—»")
```

### åœºæ™¯3: å¤šæºæ–°é—»èšåˆ

```python
# ä½¿ç”¨ç»Ÿä¸€æ¥å£ï¼Œè‡ªåŠ¨èšåˆå¤šä¸ªæ–°é—»æº
news_report = get_realtime_stock_news(
    ticker='AAPL',
    curr_date='2025-11-21',
    hours_back=12
)

# åŒ…å«ï¼š
# - FinnHub (ç¾è‚¡ä¸“ç”¨)
# - Alpha Vantage (æ–°é—»æƒ…ç»ª)
# - NewsAPI (å…¨çƒæ–°é—»)
# - åå°”è¡—è§é—» (ä¸­æ–‡è´¢ç»)
```

## ğŸ”§ é…ç½®é€‰é¡¹

### è°ƒæ•´è·å–æ•°é‡

```python
# é»˜è®¤è·å–50æ¡
params = {
    'limit': 50  # å¯è°ƒæ•´ä¸º 1-50
}
```

### è°ƒæ•´æ—¶é—´èŒƒå›´

```python
# é»˜è®¤24å°æ—¶
news_items = aggregator._fetch_wallstreet_news(
    ticker='600519.SH',
    hours_back=48  # æ”¹ä¸º48å°æ—¶
)
```

### è°ƒæ•´ç›¸å…³æ€§é˜ˆå€¼

åœ¨ `realtime_news_utils.py` ä¸­ä¿®æ”¹ï¼š

```python
# å½“å‰é˜ˆå€¼: 0.5
if ticker and relevance_score < 0.5:  # æ”¹ä¸º 0.3 å¯è·å–æ›´å¤šæ–°é—»
    skipped_count += 1
    continue
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

åŸºäºæµ‹è¯•ç»“æœï¼š

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| APIå“åº”æ—¶é—´ | ~0.5-0.7ç§’ |
| å•æ¬¡è·å–æ•°é‡ | æœ€å¤š50æ¡ |
| æˆåŠŸç‡ | ~100% |
| ç›¸å…³æ€§è¿‡æ»¤å | 0-5æ¡ï¼ˆå–å†³äºè‚¡ç¥¨ï¼‰ |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®è§‚æ–°é—»ä¸ºä¸»**
   - åå°”è¡—è§é—»ä¸»è¦æä¾›å®è§‚ç»æµã€æ”¿ç­–ã€å¸‚åœºåŠ¨æ€æ–°é—»
   - ä¸ªè‚¡æ–°é—»è¾ƒå°‘ï¼Œå»ºè®®é…åˆå…¶ä»–æ–°é—»æº

2. **æ— è‚¡ç¥¨ç­›é€‰**
   - APIä¸æ”¯æŒæŒ‰è‚¡ç¥¨ä»£ç ç­›é€‰
   - éœ€è¦è·å–æ‰€æœ‰æ–°é—»åå†è¿‡æ»¤
   - å› æ­¤ä¸ªè‚¡ç›¸å…³æ–°é—»å‘½ä¸­ç‡è¾ƒä½

3. **ç›¸å…³æ€§è¿‡æ»¤**
   - é»˜è®¤è¿‡æ»¤ç›¸å…³æ€§ < 0.5 çš„æ–°é—»
   - å¯èƒ½é”™è¿‡ä¸€äº›é—´æ¥ç›¸å…³çš„æ–°é—»
   - å¯æ ¹æ®éœ€æ±‚è°ƒæ•´é˜ˆå€¼

4. **æ›´æ–°é¢‘ç‡**
   - å®æ—¶æ›´æ–°ï¼Œå»ºè®®æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
   - é¿å…é¢‘ç¹è°ƒç”¨ï¼Œå»ºè®®é—´éš”30ç§’ä»¥ä¸Š

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1: è·å–åˆ°0æ¡æ–°é—»

**å¯èƒ½åŸå› **:
- ç›¸å…³æ€§è¿‡æ»¤ï¼šæ–°é—»ä¸­æœªæåŠç›®æ ‡è‚¡ç¥¨
- æ—¶é—´èŒƒå›´å†…æ— æ–°é—»

**è§£å†³æ–¹æ¡ˆ**:
```python
# 1. æ‰©å¤§æ—¶é—´èŒƒå›´
news_items = aggregator._fetch_wallstreet_news(ticker, hours_back=48)

# 2. ä¸æŒ‡å®šè‚¡ç¥¨ï¼ˆè·å–æ‰€æœ‰æ–°é—»ï¼‰
news_items = aggregator._fetch_wallstreet_news('', hours_back=24)

# 3. è°ƒæ•´ç›¸å…³æ€§é˜ˆå€¼ï¼ˆä¿®æ”¹ä»£ç ï¼‰
```

### é—®é¢˜2: APIè¿”å›é”™è¯¯

**å¯èƒ½åŸå› **:
- ç½‘ç»œé—®é¢˜
- APIç«¯ç‚¹å˜æ›´

**è§£å†³æ–¹æ¡ˆ**:
```python
# æ£€æŸ¥APIçŠ¶æ€
python scripts/test_wallstreet_news.py

# æŸ¥çœ‹åŸå§‹å“åº”
import requests
response = requests.get(
    "https://api-prod.wallstreetcn.com/apiv1/content/lives",
    params={'channel': 'global-channel', 'limit': 5}
)
print(response.text)
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ–°é—»APIé…ç½®æ–‡æ¡£](./NEWS_API_SETUP.md)
- [å®æ—¶æ–°é—»å·¥å…·æºç ](../tradingagents/dataflows/realtime_news_utils.py)
- [æµ‹è¯•è„šæœ¬](../scripts/test_wallstreet_news.py)

## ğŸ”— å…¶ä»–æ–°é—»æº

é¡¹ç›®é›†æˆçš„å…¶ä»–æ–°é—»æºï¼š

1. **è´¢è”ç¤¾** - å®æ—¶å¿«è®¯ï¼Œæ— éœ€API key
2. **Tushare** - Aè‚¡æ–°é—»ï¼Œéœ€è¦ä¸“ç”¨token
3. **FinnHub** - ç¾è‚¡æ–°é—»ï¼Œéœ€è¦API key
4. **Alpha Vantage** - æ–°é—»æƒ…ç»ªåˆ†æï¼Œéœ€è¦API key
5. **NewsAPI** - å…¨çƒæ–°é—»èšåˆï¼Œéœ€è¦API key

å»ºè®®æ ¹æ®ç›®æ ‡å¸‚åœºé€‰æ‹©åˆé€‚çš„æ–°é—»æºç»„åˆã€‚

---

**æ›´æ–°æ—¶é—´**: 2025-11-21
**ç»´æŠ¤è€…**: Claude Code
