# æ™ºèƒ½é€‰è‚¡è®­ç»ƒç³»ç»Ÿä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

ä¸‰é˜¶æ®µæ™ºèƒ½é€‰è‚¡è®­ç»ƒç³»ç»Ÿï¼Œå®ç°ä»æ¿å—å†…æ‰€æœ‰è‚¡ç¥¨è‡ªåŠ¨ç­›é€‰åˆ°æœ€ç»ˆå›æµ‹çš„å®Œæ•´æµç¨‹ã€‚

## ä¸‰é˜¶æ®µæµç¨‹

### Phase 1: é‡åŒ–å¿«é€Ÿç­›é€‰
**ç›®æ ‡**: æ¿å—æ‰€æœ‰è‚¡ç¥¨ â†’ Top 20 å€™é€‰

**ç­›é€‰æ ‡å‡†**:
- åŸºæœ¬é¢: ROE > 10%, è´Ÿå€ºç‡ < 60%, è¥æ”¶å¢é•¿ > 0%
- ä¼°å€¼: PE < 30, PB < 3
- æŠ€æœ¯é¢: MAå¤šå¤´æ’åˆ—ä¼˜å…ˆï¼Œæˆäº¤é‡æ”¾å¤§
- æµåŠ¨æ€§: æ¢æ‰‹ç‡ > 1%

**è¯„åˆ†ç»´åº¦**:
- åŸºæœ¬é¢è¯„åˆ† (40åˆ†): ROE, è´Ÿå€ºç‡, è¥æ”¶å¢é•¿
- ä¼°å€¼è¯„åˆ† (20åˆ†): PE, PB
- æŠ€æœ¯é¢è¯„åˆ† (30åˆ†): MAè¶‹åŠ¿, æˆäº¤é‡, ä»·æ ¼åŠ¨é‡
- æµåŠ¨æ€§è¯„åˆ† (10åˆ†): æ¢æ‰‹ç‡

### Phase 2: LLMæ·±åº¦åˆ†æ
**ç›®æ ‡**: Top 20 å€™é€‰ â†’ Top 5 ç²¾é€‰

**åˆ†ææ–¹æ³•**:
- è°ƒç”¨å®Œæ•´Multi-Agentç³»ç»Ÿ (7ä¸ªAgent)
- æŠ€æœ¯åˆ†æAgentè¯„åˆ† (30%æƒé‡)
- åŸºæœ¬é¢Agentè¯„åˆ† (30%æƒé‡)
- æƒ…ç»ªAgentè¯„åˆ† (20%æƒé‡)
- é£é™©Agentè¯„åˆ† (20%æƒé‡)

**æœ€ç»ˆè¯„åˆ†**:
```
final_score = quantitative_score * 0.4 + llm_score * 0.6
```

### Phase 3: ç»„åˆå›æµ‹
**ç›®æ ‡**: Top 5 ç²¾é€‰ â†’ è®­ç»ƒEpisode

**å›æµ‹æµç¨‹**:
- æ¯åªè‚¡ç¥¨åˆ†é…20%ä»“ä½
- æŒä»“Nå¤©åé€€å‡º
- è®¡ç®—ç»„åˆæ”¶ç›Šç‡
- ç”Ÿæˆç»¼åˆè®­ç»ƒç»éªŒ

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
cd backend

# ç§‘æŠ€æ¿å—è®­ç»ƒ
python scripts/intelligent_sector_training.py \
  --sector ç§‘æŠ€ \
  --start 2024-07-01 \
  --end 2024-08-31

# æ¶ˆè´¹æ¿å—è®­ç»ƒ
python scripts/intelligent_sector_training.py \
  --sector æ¶ˆè´¹ \
  --start 2024-07-01 \
  --end 2024-08-31
```

### å®Œæ•´å‚æ•°

```bash
python scripts/intelligent_sector_training.py \
  --sector ç§‘æŠ€ \           # æ¿å—åç§°ï¼ˆå¿…å¡«ï¼‰
  --start 2024-07-01 \      # å¼€å§‹æ—¥æœŸï¼ˆå¿…å¡«ï¼‰
  --end 2024-08-31 \        # ç»“æŸæ—¥æœŸï¼ˆå¿…å¡«ï¼‰
  --holding-days 5 \        # æŒä»“å¤©æ•°ï¼ˆé»˜è®¤5ï¼‰
  --phase1-top-k 20 \       # Phase 1ç­›é€‰æ•°é‡ï¼ˆé»˜è®¤20ï¼‰
  --phase2-top-k 5          # Phase 2ç­›é€‰æ•°é‡ï¼ˆé»˜è®¤5ï¼‰
```

### æ”¯æŒçš„æ¿å—

- `é‡‘è`: é“¶è¡Œã€éé“¶é‡‘èã€ä¿é™©
- `ç§‘æŠ€`: ç”µå­ã€è®¡ç®—æœºã€é€šä¿¡ã€ä¼ åª’
- `æ¶ˆè´¹`: é£Ÿå“é¥®æ–™ã€å®¶ç”µã€çººç»‡ã€é›¶å”®ã€å†œä¸š
- `åŒ»è¯`: åŒ»è¯ç”Ÿç‰©
- `å‘¨æœŸ`: é’¢é“ã€æœ‰è‰²é‡‘å±ã€åŒ–å·¥ã€å»ºæã€ç…¤ç‚­
- `åˆ¶é€ `: æœºæ¢°è®¾å¤‡ã€ç”µæ°”è®¾å¤‡ã€æ±½è½¦ã€å†›å·¥
- `åœ°äº§`: æˆ¿åœ°äº§ã€å»ºç­‘è£…é¥°
- `å…¬ç”¨`: å…¬ç”¨äº‹ä¸šã€äº¤é€šè¿è¾“ã€ç”µåŠ›

## è®­ç»ƒæ•°æ®ç¤ºä¾‹

### Episodeç»“æ„

æ¯ä¸ªè®­ç»ƒEpisodeåŒ…å«:

```markdown
# æ™ºèƒ½é€‰è‚¡æˆåŠŸæ¡ˆä¾‹: ç§‘æŠ€æ¿å—

## ğŸ” Phase 1: é‡åŒ–ç­›é€‰
- æ¿å—å†…è‚¡ç¥¨æ€»æ•°: 127åª
- ç­›é€‰åå€™é€‰æ•°: 20åª

Top 5 å€™é€‰:
1. 000063.SZ (ä¸­å…´é€šè®¯) - è¯„åˆ†: 85.2
   - ROE: 15.3%
   - PE: 25.6
   - è¶‹åŠ¿: bullish

## ğŸ¤– Phase 2: LLMæ·±åº¦åˆ†æ
- åˆ†æå€™é€‰æ•°: 20åª
- æœ€ç»ˆç­›é€‰æ•°: 5åª

1. 000063.SZ (ä¸­å…´é€šè®¯)
   - é‡åŒ–è¯„åˆ†: 85.2/100
   - LLMè¯„åˆ†: 8.5/10
   - ç»¼åˆè¯„åˆ†: 90.1
   - æŠ€æœ¯é¢: 8.5/10
   - åŸºæœ¬é¢: 8.0/10
   - æƒ…ç»ªé¢: 7.5/10
   - é£é™©è¯„ä¼°: 8.0/10
   - æ¨è: strong_buy

## ğŸ’¼ Phase 3: ç»„åˆå›æµ‹
- æŒä»“æ•°é‡: 5åª
- æŠ•å…¥èµ„é‡‘: Â¥1,000,000
- æŒä»“å‘¨æœŸ: 5å¤©

æŒä»“æ˜ç»†:
### 000063.SZ (ä¸­å…´é€šè®¯)
- ä¹°å…¥ä»·: Â¥35.20
- å–å‡ºä»·: Â¥36.80
- æ”¶ç›Šç‡: +4.55%
- ç›ˆäº: +Â¥8,960

## ğŸ“Š ä¸šç»©æ€»ç»“
- ç»„åˆæ”¶ç›Šç‡: +3.2%
- æˆåŠŸç‡: 80.0%
- æ€»ç›ˆäº: +Â¥32,000

## ğŸ’¡ é€‰è‚¡ç»éªŒæ€»ç»“
âœ… æˆåŠŸå› ç´ :
- é‡åŒ–ç­›é€‰æœ‰æ•ˆè¿‡æ»¤å‡ºä¼˜è´¨å€™é€‰
- LLMåˆ†æè¯†åˆ«äº†é«˜æ½œåŠ›è‚¡ç¥¨
- ç»„åˆåˆ†æ•£é™ä½äº†é£é™©
```

## è¿è¡Œç¤ºä¾‹

### æµ‹è¯•è¿è¡Œï¼ˆå•æ—¥ï¼‰

```bash
# æµ‹è¯•ç§‘æŠ€æ¿å—ï¼ˆå•æ—¥å¿«é€Ÿæµ‹è¯•ï¼‰
python scripts/intelligent_sector_training.py \
  --sector ç§‘æŠ€ \
  --start 2024-07-01 \
  --end 2024-07-02 \
  --holding-days 5
```

é¢„æœŸè¾“å‡º:
```
Initializing TradingAgents system...
Intelligent Sector Trainer initialized
   Sector: ç§‘æŠ€
   Phase 1: All stocks â†’ Top 20
   Phase 2: Top 20 â†’ Top 5
   Phase 3: Portfolio backtest with 5 stocks

Starting Intelligent Sector Training
============================================================

Fetching all stocks in sector: ç§‘æŠ€
   Industry 'ç”µå­': 45 stocks
   Industry 'è®¡ç®—æœº': 38 stocks
   Industry 'é€šä¿¡': 25 stocks
   Industry 'ä¼ åª’': 19 stocks
Total stocks in sector 'ç§‘æŠ€': 127

Phase 1: Quantitative filtering 127 stocks...
Phase 1 complete: 85 analyzed, Top 20 selected
   Score range: 75.3 - 45.2

Phase 2: LLM deep analysis on 20 candidates...
   [1/20] Analyzing 000063.SZ (ä¸­å…´é€šè®¯)...
      Scores: Quant=75.3, LLM=8.5, Final=83.1
   [2/20] Analyzing 002415.SZ (æµ·åº·å¨è§†)...
      Scores: Quant=72.1, LLM=8.2, Final=80.4
   ...

Phase 2 complete: 20 analyzed, Top 5 selected
   Final score range: 83.1 - 78.5

Phase 3: Portfolio backtest with 5 stocks...
   BUY 000063.SZ: 5600 shares @ Â¥35.20
   BUY 002415.SZ: 4200 shares @ Â¥47.50
   ...
   EXIT 000063.SZ: +4.55% after 5 days
   EXIT 002415.SZ: +2.31% after 5 days

Phase 3 complete:
   Positions: 5
   Portfolio return: +3.20%
   Success rate: 80.0%

âœ… Episode stored (profitable)
```

### å®Œæ•´è®­ç»ƒï¼ˆ2ä¸ªæœˆï¼‰

```bash
# åå°è¿è¡Œï¼ˆæ¨èï¼‰
nohup python scripts/intelligent_sector_training.py \
  --sector ç§‘æŠ€ \
  --start 2024-07-01 \
  --end 2024-08-31 \
  --holding-days 5 \
  > intelligent_tech_training.log 2>&1 &

# ç›‘æ§è¿›åº¦
tail -f intelligent_tech_training.log
```

## æ€§èƒ½ä¸æˆæœ¬

### æ—¶é—´ä¼°ç®—

**å•æ—¥è®­ç»ƒæ—¶é—´**:
- Phase 1 (é‡åŒ–ç­›é€‰): ~10ç§’ (100+åªè‚¡ç¥¨)
- Phase 2 (LLMåˆ†æ): ~60ç§’ (20åªè‚¡ç¥¨ * 3ç§’/åª)
- Phase 3 (ç»„åˆå›æµ‹): ~5ç§’
- **æ€»è®¡**: ~75ç§’/å¤©

**2ä¸ªæœˆè®­ç»ƒ** (çº¦40ä¸ªäº¤æ˜“æ—¥):
- æ€»æ—¶é—´: ~50åˆ†é’Ÿ

### LLMæˆæœ¬ä¼°ç®—

**Phase 2 LLMè°ƒç”¨é‡**:
- æ¯æ—¥: 20æ¬¡å®Œæ•´Multi-Agentåˆ†æ
- 2ä¸ªæœˆ: 20 * 40 = 800æ¬¡åˆ†æ

**æˆæœ¬ä¼˜åŒ–**:
- Phase 1é‡åŒ–ç­›é€‰æ— LLMæˆæœ¬
- Phase 2ä»…å¯¹Top 20å€™é€‰è°ƒç”¨LLMï¼ˆè€Œéå…¨éƒ¨100+åªï¼‰
- å¯è°ƒæ•´`--phase2-top-k`é™ä½LLMè°ƒç”¨é‡

## Memory BankæŸ¥è¯¢

è®­ç»ƒå®Œæˆåï¼Œå¯é€šè¿‡Memory BankæŸ¥è¯¢æ™ºèƒ½é€‰è‚¡ç»éªŒï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰æ™ºèƒ½é€‰è‚¡Episodes
curl "http://localhost:8000/api/v1/memory/episodes?symbol=INTELLIGENT_ç§‘æŠ€"

# æˆ–é€šè¿‡å‰ç«¯ç•Œé¢æµè§ˆ
æ‰“å¼€å‰ç«¯ â†’ Memory Bank â†’ ç­›é€‰ symbol: "INTELLIGENT_*"
```

### æŸ¥è¯¢åœºæ™¯

**åœºæ™¯1: æ¿å—é€‰è‚¡æˆåŠŸç‡**
```
Q: ç§‘æŠ€æ¿å—ä¸­ï¼Œå“ªäº›è‚¡ç¥¨ç±»å‹æˆåŠŸç‡é«˜ï¼Ÿ
A: æ ¹æ®20ä¸ªEpisodesï¼ŒæŠ€æœ¯é¢+åŸºæœ¬é¢åŒå¼ºçš„è‚¡ç¥¨æˆåŠŸç‡75%
   - é‡åŒ–è¯„åˆ† > 70
   - LLMè¯„åˆ† > 8.0
   - MAå¤šå¤´æ’åˆ— + ROE > 15%
```

**åœºæ™¯2: é€‰è‚¡æ ‡å‡†ä¼˜åŒ–**
```
Q: é‡åŒ–ç­›é€‰ä¸­å“ªäº›æŒ‡æ ‡æœ€é‡è¦ï¼Ÿ
A: åˆ†æå‘ç°ï¼š
   - ROEæƒé‡åº”æé«˜ï¼ˆå½“å‰æˆåŠŸæ¡ˆä¾‹å¹³å‡ROE=18%ï¼‰
   - PE < 25æ›´åˆé€‚ï¼ˆå½“å‰30åé«˜ï¼‰
   - æˆäº¤é‡æ”¾å¤§æ˜¯å¼ºä¿¡å·ï¼ˆvolume_ratio > 1.5ï¼‰
```

**åœºæ™¯3: LLMåˆ†æä»·å€¼**
```
Q: LLMåˆ†æç›¸æ¯”çº¯é‡åŒ–æœ‰å¤šå¤§æå‡ï¼Ÿ
A: LLMæ·±åº¦åˆ†æå°†æˆåŠŸç‡ä»55%æå‡åˆ°70%
   - æŠ€æœ¯é¢+æƒ…ç»ªé¢æ•æ‰äº†çŸ­æœŸæœºä¼š
   - é£é™©è¯„ä¼°æœ‰æ•ˆè§„é¿äº†é«˜é£é™©è‚¡ç¥¨
```

## å¤šæ¿å—æ‰¹é‡è®­ç»ƒ

åˆ›å»ºæ‰¹é‡è®­ç»ƒè„šæœ¬:

```bash
# batch_training.sh
#!/bin/bash

SECTORS=("ç§‘æŠ€" "æ¶ˆè´¹" "åŒ»è¯" "é‡‘è")

for SECTOR in "${SECTORS[@]}"
do
    echo "=== Training $SECTOR ==="

    nohup python scripts/intelligent_sector_training.py \
      --sector $SECTOR \
      --start 2024-07-01 \
      --end 2024-08-31 \
      --holding-days 5 \
      > "intelligent_${SECTOR}_training.log" 2>&1 &

    # Wait between sectors to avoid overwhelming the system
    sleep 60
done

echo "All sector trainings started!"
```

è¿è¡Œ:
```bash
chmod +x batch_training.sh
./batch_training.sh
```

## æ•…éšœæ’æŸ¥

### 1. Tushare Tokené”™è¯¯
```
ValueError: TUSHARE_TOKEN not found in .env
```
**è§£å†³**: ç¡®ä¿`.env`æ–‡ä»¶åŒ…å«æœ‰æ•ˆçš„Tushare token:
```
TUSHARE_TOKEN=your_token_here
```

### 2. æ¿å—å†…è‚¡ç¥¨æ•°é‡è¿‡å°‘
```
WARNING: Too few stocks in sector (8), skipping
```
**åŸå› **: æŸäº›æ¿å—è‚¡ç¥¨æ•°é‡æœ¬èº«è¾ƒå°‘
**è§£å†³**: è°ƒæ•´`--phase1-top-k`å‚æ•°é™ä½ç­›é€‰æ•°é‡

### 3. Phase 1è¿”å›ç©ºç»“æœ
```
WARNING: Phase 1 returned no candidates, skipping
```
**åŸå› **: ç­›é€‰æ ‡å‡†è¿‡ä¸¥ï¼Œæ²¡æœ‰è‚¡ç¥¨æ»¡è¶³æ¡ä»¶
**è§£å†³**: åœ¨ä»£ç ä¸­æ”¾å®½é‡åŒ–ç­›é€‰æ ‡å‡†

### 4. LLM Rate Limit
```
ERROR: Rate limit exceeded
```
**è§£å†³**:
- è„šæœ¬å·²å†…ç½®0.5ç§’å»¶è¿Ÿ
- å¦‚ä»ç„¶è¶…é™ï¼Œå¢åŠ `time.sleep()`é—´éš”

## æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **ç¼“å­˜ä¼˜åŒ–**: ç¼“å­˜é‡å¤å‡ºç°è‚¡ç¥¨çš„åˆ†æç»“æœ
2. **å¹¶è¡Œåˆ†æ**: Phase 2çš„20åªå€™é€‰å¯å¹¶è¡Œåˆ†æ
3. **å¢é‡è®­ç»ƒ**: åªåˆ†ææ–°äº¤æ˜“æ—¥ï¼Œé¿å…é‡å¤
4. **è‡ªé€‚åº”ç­›é€‰**: æ ¹æ®å†å²æˆåŠŸç‡åŠ¨æ€è°ƒæ•´ç­›é€‰æ ‡å‡†

---

**åˆ›å»ºæ—¥æœŸ**: 2025-11-10
**ç‰ˆæœ¬**: 1.0
**ä½œè€…**: Claude Code
