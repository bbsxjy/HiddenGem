# HiddenGem Alpha策略设计方案

## 📋 文档概述

本文档定义了HiddenGem从"数据聚合工具"进化为"Alpha生成系统"的完整方案。

**核心洞察**：信息优势（研报情报）+ 技术系统（小模型+ML） = 可持续Alpha

**最后更新**：2025-01-04

---

## 🎯 系统愿景

### 当前问题

现状：系统本质上是"把人工看数据→喂给LLM"的自动化，价值有限
- ❌ 任何人都能用Tushare + ChatGPT复制
- ❌ 没有产生"新知识"或"更好的洞察"
- ❌ 成本高（¥1500-3000/月）
- ❌ 无法持续学习和优化

### 目标愿景

**打造基于信息优势的量化交易系统**，具备：
- ✅ 合法的信息时间差（研报提前1-3天）
- ✅ 自有的小模型（成本降低80%）
- ✅ 持续学习能力（系统越用越准）
- ✅ 规模效应（同时监控5000+只股票）
- ✅ 深度洞察（产业链、事件驱动）

---

## 💎 核心优势分析

### 1. 信息层级理论（A股市场）

```
Level 4: 内幕消息（业绩、重组）❌ 违法
         ↓
Level 3: 机构路演、私下调研 ⚠️ 灰色地带
         ↓
Level 2: 研报发布前1-2天 ✅ 合法优势 ← 【我们的位置】
       - 分析师内部讨论
       - 调研纪要（已合规发布）
       - 研报推送优先级
         ↓
Level 1: 公开研报（发布当天）
         ↓
Level 0: 散户看到（滞后1-2天）
```

**我们的优势**：处在Level 2，比散户快1-3天

### 2. A股研报效应数据

- **首次覆盖/调高评级**：T+1日平均涨幅 1.5-3%
- **重点推荐**：T+2到T+5累计涨幅 2-4%
- **时效性**：发布后1小时，已经被price in 70%

**关键**：必须在研报公开前提前布局

### 3. 信息优势来源

通过东方财富研究所销售岗位，可以合法获取：
- ✅ 即将发布的研报（提前1天）
- ✅ 分析师信心度（内部讨论观察）
- ✅ 调研纪要（已合规发布）
- ✅ 行业专家电话会观点
- ✅ 路演日程和规模
- ✅ 研报推送优先级

---

## 🏗️ 技术架构设计

### 三层混合模型架构

```
┌─────────────────────────────────────────────┐
│  Layer 3: 大模型API (DeepSeek/GPT)          │ ← 深度推理、复杂解释
│  成本：¥0.2/次，仅用于重要决策              │
│  使用场景：不确定性高、需要复杂推理         │
└─────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────┐
│  Layer 2: 小模型 Fine-tune                   │ ← 研报情绪、信号分类
│  - FinBERT-Chinese (研报情感分析)            │
│  - Qwen-7B (轻量级推理)                      │
│  成本：¥0.01/次，本地部署                   │
│  使用场景：文本分析、常规判断                │
└─────────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────────┐
│  Layer 1: 传统ML (XGBoost/LightGBM)         │ ← 涨跌预测、因子模型
│  成本：免费，推理极快（<10ms）               │
│  使用场景：快速筛选、量化打分                │
└─────────────────────────────────────────────┘
```

### 核心模块设计

#### 模块1: 研报情报系统 (ResearchIntel)

**功能**：采集、量化研报相关信息

```python
class ResearchIntel:
    """研报情报采集与量化"""

    def collect_signals(self):
        """
        采集信号类型：
        1. 即将发布的研报（最重要）
        2. 近期调研记录
        3. 行业电话会
        4. 路演日程
        """
        return {
            "upcoming_reports": [...],  # 提前1天知道的研报
            "recent_research": [...],   # 实地调研记录
            "industry_calls": [...],    # 行业专家观点
            "roadshows": [...]          # 路演规模和日程
        }

    def quantify_research_signal(self, report):
        """
        将研报信息量化为信号强度 [0, 1]

        考虑因素：
        - 评级变动（中性→买入 = 高分）
        - 分析师信心度（1-10）
        - 覆盖类型（首次覆盖 = 高分）
        - 上涨空间（目标价 vs 当前价）
        - 调研深度（实地调研 > 电话会议）
        """
        score = 0

        if report["rating_change"] == "中性→买入":
            score += 0.3

        score += report["analyst_conviction"] / 10 * 0.2

        if report["coverage_type"] == "首次覆盖":
            score += 0.2

        if report["upside"] > 20:
            score += 0.15

        if report["research_depth"] == "深度调研":
            score += 0.15

        return min(score, 1.0)
```

**数据示例**：
```json
{
  "symbol": "300750",
  "analyst": "张三",
  "publish_time": "2025-01-15 10:00",
  "rating": "买入",
  "rating_change": "中性→买入",
  "target_price": 45.0,
  "current_price": 38.5,
  "upside": 16.9,
  "analyst_conviction": 9,
  "research_depth": "深度调研",
  "push_priority": "高",
  "coverage_type": "首次覆盖"
}
```

#### 模块2: 小模型系统 (SmallLLM)

**模型1：研报情绪分析模型**
- 基础模型：FinBERT-Chinese
- 输入：研报全文
- 输出：情绪分数 [-1, 1]
- 训练数据：1000+篇历史研报 + 发布后收益率标注
- 预期准确率：65-70%
- 推理成本：¥0.01/次

**模型2：信号综合分类器**
- 算法：LightGBM
- 输入：30+维特征（技术面+基本面+情绪面+研报面）
- 输出：BUY/HOLD/SELL + 置信度
- 训练数据：历史所有分析 + 未来收益率
- 预期准确率：60-65%
- 推理成本：免费

**关键特征**（30+维）：
```python
features = {
    # 技术面 (10维)
    "rsi": 45.2,
    "macd": 0.5,
    "trend_strength": 0.7,
    # ...

    # 基本面 (8维)
    "pe_percentile": 0.3,
    "roe": 15.5,
    "debt_ratio": 0.4,
    # ...

    # 情绪面 (7维)
    "net_inflow": 50000000,
    "turnover_rate": 8.5,
    # ...

    # 🔑 研报面 (5维) - 独特优势
    "upcoming_report_score": 0.85,      # 即将发布研报的强度
    "recent_research_count": 3,         # 最近30天研报数
    "avg_rating": 4.2,                  # 平均评级(1-5)
    "rating_trend": 0.5,                # 评级趋势(上调=正)
    "analyst_conviction_avg": 8.5,      # 平均分析师信心
}
```

**模型3：价格预测模型（可选）**
- 架构：LSTM
- 输入：60天窗口 × 30维特征
- 输出：未来5日收益率
- 训练数据：500只股票 × 2年
- 预期准确率：55-60%

#### 模块3: 决策引擎 (AlphaEngine)

```python
def analyze_with_research_intel(self, symbol: str):
    """
    融合研报情报的完整分析流程
    """

    # Step 1: Layer 1 快速过滤（传统ML）
    ml_score = self.ml_models.quick_score(symbol)
    if ml_score < 0.3:
        return {"signal": "SKIP", "reason": "ML快速过滤"}

    # Step 2: 提取研报信号
    research_score = self.get_research_signal(symbol)

    # 🔑 高价值研报信号 → 直接买入
    if research_score > 0.7:
        return {
            "signal": "BUY",
            "confidence": 0.85,
            "reason": "研报即将发布，信号强度高",
            "source": "research_intelligence"
        }

    # Step 3: Layer 2 小模型综合判断
    features = self.extract_all_features(symbol, research_score)
    small_llm_result = self.small_llm.predict(features)

    if small_llm_result["confidence"] > 0.75:
        return small_llm_result

    # Step 4: Layer 3 大模型深度分析（仅不确定时）
    if small_llm_result["confidence"] < 0.6:
        big_llm_result = self.big_llm.analyze(symbol)
        return big_llm_result

    return small_llm_result
```

---

## 📅 实施路线图

### Phase 1: 数据基建（1-2个月）

**目标**：建立研报数据库，量化研报效应

**任务清单**：
- [ ] 爬取东财所有研报（2020年至今，1000+篇）
- [ ] 建立研报数据库（分析师/评级/目标价/发布时间）
- [ ] 计算研报发布后收益率（1d/3d/5d/10d）
- [ ] 统计每个分析师的历史准确率
- [ ] 识别"神分析师"（准确率>60%）
- [ ] 分析哪些行业的研报最有效
- [ ] 回测：评级上调/首次覆盖 → 未来涨幅
- [ ] 设计信息采集SOP（与妻子确认合规信息）

**预期产出**：
- ✅ 1000+篇研报训练数据
- ✅ 研报效应量化报告
- ✅ 分析师准确率排名
- ✅ 信息采集标准流程

**关键指标**：
- 评级上调后5日平均涨幅
- 首次覆盖后10日平均涨幅
- 分析师胜率Top 10
- 最有效的行业Top 5

### Phase 2: 模型训练（2-3个月）

**目标**：训练3个小模型，降低80%成本

**模型训练优先级**：

1. **ResearchSentimentModel**（优先级1）
   - 基础模型：FinBERT-Chinese
   - 训练数据：1000篇研报 + 收益率标注
   - 预期准确率：65-70%
   - 推理成本：¥0.01/次
   - 价值：量化研报质量

2. **SignalClassifier**（优先级2）
   - 算法：LightGBM
   - 特征数：30+维（含研报特征）
   - 预期准确率：60-65%
   - 推理成本：免费
   - 价值：替代大模型，降低80%成本

3. **PricePredictionLSTM**（优先级3，可选）
   - 架构：LSTM
   - 训练数据：500只股票 × 2年
   - 预期准确率：55-60%
   - 推理成本：¥0.005/次
   - 价值：量化预期收益

**预期产出**：
- ✅ 3个训练好的模型
- ✅ 回测报告（有研报信号 vs 无研报信号的alpha差异）
- ✅ 成本降低至¥300-500/月

### Phase 3: 信息系统（3-4个月）

**目标**：建立自动化研报情报系统

**功能设计**：

```python
class ResearchIntelligenceSystem:
    """每日工作流"""

    def daily_routine(self):
        # 早上9:00 - 采集今日信息
        intel = self.collect_from_wife()

        # 9:15 - 分析即将发布的研报
        for report in intel["明日发布研报"]:
            score = self.quantify(report)

            if score > 0.75:
                # 高价值信号 → 今日布局
                self.send_alert(f"⚠️ {report['symbol']} 明日重磅研报")

                # 完整分析
                analysis = self.analyze_with_ml(report['symbol'])

                if analysis['signal'] == 'BUY':
                    self.add_to_watchlist(report['symbol'])

        # 14:30 - 复盘
        self.backtest_todays_calls()
```

**预期产出**：
- ✅ 自动化信息采集系统
- ✅ 每日研报预警
- ✅ 提前1天布局信号

### Phase 4: 实盘验证（4-6个月）

**目标**：小资金验证策略有效性

**测试方案**：
- 初始资金：¥50,000
- 策略：仅跟随高置信度研报信号（score > 0.75）
- 风控：
  - 单票仓位 ≤ 20%
  - 止损：-5%
  - 止盈：+10%

**跟踪指标**：
- 研报信号准确率
- 小模型 vs 大模型准确率对比
- Alpha来源拆解（研报贡献多少）
- 夏普比率
- 最大回撤

**预期目标**：
- ✅ 研报信号胜率 > 60%
- ✅ 月化收益 > 市场平均+2%
- ✅ 验证信息优势的实际价值

---

## 🔒 合规边界

### ✅ 可以使用的信息（安全）

- 研报发布前1天知道（已定稿，即将发布）
- 分析师信心度（通过内部讨论观察）
- 调研纪要（已合规发布的）
- 行业专家电话会观点（已公开的）
- 路演日程和规模
- 研报推送优先级

### ❌ 绝对不能使用（违法）

- 未披露的业绩数据
- 未公告的重组/定增
- 公司高管私下透露的信息
- 机构提前得知的利好/利空
- 任何形式的内幕消息

### ⚠️ 灰色地带（谨慎使用）

- 调研后分析师的个人观点（需确认公司未披露相关数据）
- 路演中的业绩展望（需确认是否为公开指引）

### 合规检查器设计

```python
class ComplianceChecker:
    """合规检查器"""

    def is_safe(self, info):
        """判断信息是否可用"""

        # 规则1：信息来源必须是分析师/销售，不是公司内部
        if info['source'] == 'company_insider':
            return False

        # 规则2：如果是业绩相关，必须是公司已披露的
        if '业绩' in info['content']:
            if not info['is_public_guidance']:
                return False

        # 规则3：研报最多提前1天知道
        if info['type'] == 'upcoming_report':
            if info['publish_time'] > now() + timedelta(days=1.5):
                return False  # 提前太多=风险

        return True
```

**安全原则**：
1. 只用"分析师观点"，不用"公司内部信息"
2. 只用"即将公开"的，不用"远期未公开"的
3. 记录信息来源，可溯源
4. 系统运行日志完整保留

---

## 💰 成本与收益分析

### 成本对比

| 项目 | 现状（纯API） | 优化后（混合） | 节省 |
|------|--------------|---------------|------|
| 模型推理 | ¥1,500/月 | ¥300/月 | 80% ↓ |
| 服务器（GPU） | ¥0 | ¥500/月 | - |
| 数据源 | ¥200/月 | ¥200/月 | 0 |
| **总计** | **¥1,700/月** | **¥1,000/月** | **41% ↓** |

### 收益测算（保守估计）

**假设条件**：
- 资金：¥100,000
- 月交易次数：10次（保守）
- 研报信号胜率：65%（保守，历史数据显示首次覆盖胜率70%+）
- 单次盈亏比：2:1（盈利10%，止损5%）
- 单次仓位：30%

**计算**：
```
月化收益 = 10 × 0.3 × (0.65 × 0.10 - 0.35 × 0.05)
        = 10 × 0.3 × 0.0475
        = 0.1425 (14.25%)

年化收益（复利）≈ 54%
```

**对比**：
- 沪深300年化收益：15%
- **Alpha ≈ 39%**

**如果实现70%+胜率**：年化收益可达60%+

### ROI分析

**系统开发成本**：
- Phase 1-2开发时间：3个月
- 开发成本（时间成本）：可控

**盈亏平衡点**：
- 10万资金，月化4.5%收益 = ¥4,500/月
- 系统成本：¥1,000/月
- **净收益：¥3,500/月**
- **年化净收益：¥42,000**

**放大效应**：
- 如果资金扩大到50万，年化净收益 ≈ ¥21万

---

## 🚀 立即行动（本周可开始）

### 任务1：爬取东财历史研报

**工具**：Python爬虫（requests + BeautifulSoup）

**目标**：
- 爬取2020年至今所有研报
- 最少1000篇
- 字段：股票代码、分析师、评级、目标价、发布时间

**数据标注**：
- 自动计算发布后1d/5d/10d收益率
- 标注为正面/中性/负面

**输出**：`data/research_reports.csv`

### 任务2：分析师准确率统计

**方法**：SQL聚合 + pandas分析

**关键指标**：
- 评级上调后5日平均涨幅
- 首次覆盖后10日平均涨幅
- 各分析师胜率排名
- 各行业研报效果排名

**输出**：
- `analysis/analyst_performance.csv`
- `analysis/industry_research_effect.csv`

### 任务3：与妻子沟通信息采集

**内容**：
- 确认可以提供哪些信息（合规）
- 设计每日信息采集表格
- 试运行1周，验证信息质量

**输出**：
- `docs/intel_collection_sop.md`
- `data/daily_intel_template.json`

**信息采集模板**：
```json
{
  "date": "2025-01-04",
  "upcoming_reports": [
    {
      "symbol": "300750",
      "analyst": "张三",
      "publish_time": "2025-01-05 10:00",
      "rating": "买入",
      "rating_change": "中性→买入",
      "analyst_conviction": 9,
      "coverage_type": "首次覆盖"
    }
  ],
  "recent_research": [...],
  "industry_calls": [...],
  "roadshows": [...]
}
```

---

## 🎯 成功标准

### 短期目标（3个月）

- [ ] 建立1000+篇研报数据库
- [ ] 训练出ResearchSentimentModel，准确率>65%
- [ ] 训练出SignalClassifier，准确率>60%
- [ ] 成本降低至¥1000/月以下
- [ ] 验证研报alpha存在（回测胜率>60%）

### 中期目标（6个月）

- [ ] 系统自动化运行，每日生成信号
- [ ] 小资金实盘验证，月化收益>3%
- [ ] 积累180天信号历史数据
- [ ] 模型准确率持续优化

### 长期目标（1年）

- [ ] 年化收益>50%（vs 市场15%）
- [ ] 系统管理资金规模扩大到50万+
- [ ] 建立产业链分析能力
- [ ] 实现事件驱动策略

---

## 📚 技术栈

### 数据采集与存储

- **爬虫**：requests, BeautifulSoup, Scrapy
- **数据库**：PostgreSQL + TimescaleDB
- **缓存**：Redis

### 模型训练

- **NLP模型**：transformers (FinBERT-Chinese, Qwen-7B)
- **传统ML**：LightGBM, XGBoost, scikit-learn
- **深度学习**：TensorFlow/PyTorch (LSTM)

### 部署与监控

- **推理服务**：FastAPI + Uvicorn
- **GPU服务器**：阿里云/腾讯云（单卡V100）
- **监控**：Prometheus + Grafana
- **日志**：loguru

---

## 📝 附录

### 参考资料

- A股研报效应学术研究
- 东方财富研报库
- Tushare Pro API文档
- FinBERT论文

### 数据源

- 市场数据：Tushare Pro
- 研报数据：东方财富
- 财务数据：Wind/Choice（可选）

### 风险提示

1. **模型风险**：历史表现不代表未来收益
2. **合规风险**：必须严格遵守信息使用边界
3. **市场风险**：极端行情下策略可能失效
4. **技术风险**：模型需要持续优化和监控

---

## 🔄 版本历史

- **v1.0** (2025-01-04): 初始版本，定义核心架构和路线图
- **v1.1** (待定): Phase 1完成后更新，加入回测数据
- **v2.0** (待定): Phase 2完成后更新，加入模型性能报告

---

**文档维护**：每完成一个Phase，更新本文档并提交git

**联系人**：开发者本人

**最后审核日期**：2025-01-04
